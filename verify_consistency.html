<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°é¢ä¸‹è½½ä¸€è‡´æ€§éªŒè¯</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            background: #fafbfc;
        }
        .test-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .status {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.warning { background: #fff3cd; color: #856404; }
        .status.error { background: #f8d7da; color: #721c24; }
        .test-button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            background: #007bff;
            color: white;
            font-weight: 500;
            cursor: pointer;
            margin: 8px;
            transition: all 0.2s;
        }
        .test-button:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }
        .result-area {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
        }
        .instructions {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        .step {
            margin: 10px 0;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        .step:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ å°é¢é¢„è§ˆä¸ä¸‹è½½ä¸€è‡´æ€§éªŒè¯å·¥å…·</h1>
            <p>æµ‹è¯•é¢„è§ˆæ•ˆæœä¸ä¸‹è½½å›¾ç‰‡æ˜¯å¦å®Œå…¨ä¸€è‡´</p>
        </div>

        <div class="instructions">
            <h3>ğŸ“‹ æµ‹è¯•æ­¥éª¤</h3>
            <div class="step">
                <strong>æ­¥éª¤ 1:</strong> æ‰“å¼€ä¸»åº”ç”¨é¡µé¢ (http://localhost:3000)
            </div>
            <div class="step">
                <strong>æ­¥éª¤ 2:</strong> åœ¨"å°é¢ç”Ÿæˆ"é€‰é¡¹å¡ä¸­ç”Ÿæˆä»»æ„å°é¢
            </div>
            <div class="step">
                <strong>æ­¥éª¤ 3:</strong> å›åˆ°æ­¤é¡µé¢ï¼Œç‚¹å‡»ä¸‹æ–¹çš„æµ‹è¯•æŒ‰é’®éªŒè¯ä¸€è‡´æ€§
            </div>
            <div class="step">
                <strong>æ­¥éª¤ 4:</strong> æŸ¥çœ‹æµ‹è¯•ç»“æœï¼Œç¡®è®¤ä¿®å¤æ•ˆæœ
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">
                ğŸ” DOMå…ƒç´ æ£€æŸ¥
                <span id="dom-status" class="status">ç­‰å¾…æµ‹è¯•</span>
            </div>
            <button class="test-button" onclick="validateDOMElements()">æ£€æŸ¥DOMå…ƒç´ </button>
            <div id="dom-result" class="result-area" style="display: none;"></div>
        </div>

        <div class="test-section">
            <div class="test-title">
                ğŸ¨ æ ·å¼æ¸…ç†æ£€æŸ¥
                <span id="style-status" class="status">ç­‰å¾…æµ‹è¯•</span>
            </div>
            <button class="test-button" onclick="checkStyleCleaning()">æ£€æŸ¥æ ·å¼æ¸…ç†</button>
            <div id="style-result" class="result-area" style="display: none;"></div>
        </div>

        <div class="test-section">
            <div class="test-title">
                ğŸ“ å°ºå¯¸ä¸€è‡´æ€§æ£€æŸ¥
                <span id="size-status" class="status">ç­‰å¾…æµ‹è¯•</span>
            </div>
            <button class="test-button" onclick="validateSizes()">æ£€æŸ¥å°ºå¯¸ä¸€è‡´æ€§</button>
            <div id="size-result" class="result-area" style="display: none;"></div>
        </div>

        <div class="test-section">
            <div class="test-title">
                ğŸš€ å®Œæ•´ä¸€è‡´æ€§æµ‹è¯•
                <span id="full-status" class="status">ç­‰å¾…æµ‹è¯•</span>
            </div>
            <button class="test-button" onclick="runFullTest()">è¿è¡Œå®Œæ•´æµ‹è¯•</button>
            <div id="full-result" class="result-area" style="display: none;"></div>
        </div>

        <div class="test-section">
            <div class="test-title">
                ğŸ’¾ æ¨¡æ‹Ÿä¸‹è½½æµ‹è¯•
                <span id="download-status" class="status">ç­‰å¾…æµ‹è¯•</span>
            </div>
            <button class="test-button" onclick="simulateDownload()">æ¨¡æ‹Ÿä¸‹è½½æµç¨‹</button>
            <div id="download-result" class="result-area" style="display: none;"></div>
        </div>
    </div>

    <script>
        // è·å–ä¸»çª—å£çš„å¼•ç”¨
        function getMainWindow() {
            // å°è¯•é€šè¿‡localStorageæˆ–å…¶ä»–æ–¹å¼è·å–ä¸»çª—å£
            const mainUrl = 'http://localhost:3000';
            return window.open(mainUrl, 'main', 'noopener');
        }

        // é€šç”¨ç»“æœæ˜¾ç¤ºå‡½æ•°
        function showResult(elementId, statusId, result, isSuccess) {
            const resultEl = document.getElementById(elementId);
            const statusEl = document.getElementById(statusId);
            
            resultEl.innerHTML = result;
            resultEl.style.display = 'block';
            
            statusEl.textContent = isSuccess ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥';
            statusEl.className = `status ${isSuccess ? 'success' : 'error'}`;
        }

        // DOMå…ƒç´ éªŒè¯
        async function validateDOMElements() {
            const result = [];
            let success = true;

            try {
                // ç›´æ¥åœ¨å½“å‰é¡µé¢æ£€æŸ¥ï¼ˆå¦‚æœæ˜¯åœ¨iframeä¸­ï¼‰æˆ–é€šè¿‡postMessage
                result.push('ğŸ” å¼€å§‹DOMå…ƒç´ æ£€æŸ¥...');
                
                // æ£€æŸ¥æ˜¯å¦æœ‰é¢„è§ˆå®¹å™¨çš„å¼•ç”¨
                const hasPreviewRef = localStorage.getItem('previewContainerExists');
                const hasDownloadRef = localStorage.getItem('downloadContainerExists');
                
                if (hasPreviewRef) {
                    result.push('âœ… é¢„è§ˆå®¹å™¨å¼•ç”¨å­˜åœ¨');
                } else {
                    result.push('âŒ é¢„è§ˆå®¹å™¨å¼•ç”¨ä¸å­˜åœ¨ - è¯·å…ˆåœ¨ä¸»é¡µé¢ç”Ÿæˆå°é¢');
                    success = false;
                }
                
                if (hasDownloadRef) {
                    result.push('âœ… ä¸‹è½½å®¹å™¨å¼•ç”¨å­˜åœ¨');
                } else {
                    result.push('âŒ ä¸‹è½½å®¹å™¨å¼•ç”¨ä¸å­˜åœ¨');
                    success = false;
                }
                
                result.push('');
                result.push('ğŸ’¡ æç¤º: è¯·åœ¨ä¸»é¡µé¢(localhost:3000)çš„æ§åˆ¶å°è¿è¡Œä»¥ä¸‹ä»£ç æ¥è®¾ç½®å¼•ç”¨:');
                result.push('localStorage.setItem("previewContainerExists", !!document.querySelector("[data-editable-card-container]"));');
                result.push('localStorage.setItem("downloadContainerExists", !!document.querySelector("[data-download-container]"));');
                
            } catch (error) {
                result.push(`âŒ æ£€æŸ¥å¤±è´¥: ${error.message}`);
                success = false;
            }

            showResult('dom-result', 'dom-status', result.join('<br>'), success);
        }

        // æ ·å¼æ¸…ç†æ£€æŸ¥
        async function checkStyleCleaning() {
            const result = [];
            let success = true;

            try {
                result.push('ğŸ¨ å¼€å§‹æ ·å¼æ¸…ç†æ£€æŸ¥...');
                
                const downloadContent = localStorage.getItem('downloadContent') || '';
                
                if (!downloadContent) {
                    result.push('âŒ æ— ä¸‹è½½å†…å®¹å¯æ£€æŸ¥');
                    result.push('ğŸ’¡ è¯·åœ¨ä¸»é¡µé¢æ§åˆ¶å°è¿è¡Œ: localStorage.setItem("downloadContent", document.querySelector("[data-download-container]")?.innerHTML || "");');
                    success = false;
                } else {
                    const issues = [];
                    
                    if (downloadContent.includes('rgba(59, 130, 246')) {
                        issues.push('è“è‰²ç¼–è¾‘æ¡†æ ·å¼æ®‹ç•™');
                    }
                    
                    if (downloadContent.includes('cursor: pointer')) {
                        issues.push('pointerå…‰æ ‡æ ·å¼æ®‹ç•™');
                    }
                    
                    if (downloadContent.includes('transform: scale')) {
                        issues.push('ç¼©æ”¾å˜æ¢æ®‹ç•™');
                    }
                    
                    if (downloadContent.includes('editable-')) {
                        issues.push('ç¼–è¾‘ç±»åæ®‹ç•™');
                    }
                    
                    if (issues.length === 0) {
                        result.push('âœ… æ ·å¼æ¸…ç†æ£€æŸ¥é€šè¿‡ - æ— ç¼–è¾‘æ ·å¼æ®‹ç•™');
                    } else {
                        result.push('âš ï¸ å‘ç°æ ·å¼é—®é¢˜:');
                        issues.forEach(issue => result.push(`  - ${issue}`));
                        success = false;
                    }
                }
                
            } catch (error) {
                result.push(`âŒ æ£€æŸ¥å¤±è´¥: ${error.message}`);
                success = false;
            }

            showResult('style-result', 'style-status', result.join('<br>'), success);
        }

        // å°ºå¯¸ä¸€è‡´æ€§æ£€æŸ¥
        async function validateSizes() {
            const result = [];
            let success = true;

            try {
                result.push('ğŸ“ å¼€å§‹å°ºå¯¸ä¸€è‡´æ€§æ£€æŸ¥...');
                
                const downloadContent = localStorage.getItem('downloadContent') || '';
                const sizeType = localStorage.getItem('currentSizeType') || 'xiaohongshu';
                
                const sizeConfig = {
                    xiaohongshu: { width: 900, height: 1200 },
                    video: { width: 1080, height: 1920 },
                    wechat: { width: 900, height: 268 }
                };
                
                const expectedSize = sizeConfig[sizeType];
                
                if (!downloadContent) {
                    result.push('âŒ æ— å†…å®¹å¯æ£€æŸ¥å°ºå¯¸');
                    success = false;
                } else {
                    const hasCorrectWidth = downloadContent.includes(`width:${expectedSize.width}px`) || 
                                          downloadContent.includes(`width: ${expectedSize.width}px`);
                    const hasCorrectHeight = downloadContent.includes(`height:${expectedSize.height}px`) || 
                                           downloadContent.includes(`height: ${expectedSize.height}px`);
                    
                    result.push(`æœŸæœ›å°ºå¯¸: ${expectedSize.width} x ${expectedSize.height}`);
                    result.push(`å®½åº¦æ£€æŸ¥: ${hasCorrectWidth ? 'âœ… æ­£ç¡®' : 'âŒ ä¸æ­£ç¡®'}`);
                    result.push(`é«˜åº¦æ£€æŸ¥: ${hasCorrectHeight ? 'âœ… æ­£ç¡®' : 'âŒ ä¸æ­£ç¡®'}`);
                    
                    if (hasCorrectWidth && hasCorrectHeight) {
                        result.push('âœ… å°ºå¯¸ä¸€è‡´æ€§æ£€æŸ¥é€šè¿‡');
                    } else {
                        success = false;
                    }
                }
                
            } catch (error) {
                result.push(`âŒ æ£€æŸ¥å¤±è´¥: ${error.message}`);
                success = false;
            }

            showResult('size-result', 'size-status', result.join('<br>'), success);
        }

        // å®Œæ•´æµ‹è¯•
        async function runFullTest() {
            const result = [];
            let success = true;

            result.push('ğŸš€ å¼€å§‹å®Œæ•´ä¸€è‡´æ€§æµ‹è¯•...');
            result.push('');
            
            // ä¾æ¬¡è¿è¡Œæ‰€æœ‰æ£€æŸ¥
            await validateDOMElements();
            await checkStyleCleaning();
            await validateSizes();
            
            // æ±‡æ€»ç»“æœ
            const domStatus = document.getElementById('dom-status').textContent;
            const styleStatus = document.getElementById('style-status').textContent;
            const sizeStatus = document.getElementById('size-status').textContent;
            
            result.push('ğŸ“Š æµ‹è¯•ç»“æœæ±‡æ€»:');
            result.push(`DOMå…ƒç´ : ${domStatus}`);
            result.push(`æ ·å¼æ¸…ç†: ${styleStatus}`);
            result.push(`å°ºå¯¸æ£€æŸ¥: ${sizeStatus}`);
            result.push('');
            
            const allPassed = domStatus.includes('âœ…') && styleStatus.includes('âœ…') && sizeStatus.includes('âœ…');
            
            if (allPassed) {
                result.push('ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼é¢„è§ˆä¸ä¸‹è½½ä¸€è‡´æ€§ä¿®å¤æˆåŠŸï¼');
            } else {
                result.push('âš ï¸ éƒ¨åˆ†æµ‹è¯•æœªé€šè¿‡ï¼Œéœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥');
                success = false;
            }

            showResult('full-result', 'full-status', result.join('<br>'), success);
        }

        // æ¨¡æ‹Ÿä¸‹è½½æµ‹è¯•
        async function simulateDownload() {
            const result = [];
            let success = true;

            try {
                result.push('ğŸ’¾ å¼€å§‹æ¨¡æ‹Ÿä¸‹è½½æµç¨‹æµ‹è¯•...');
                
                const downloadContent = localStorage.getItem('downloadContent') || '';
                
                if (!downloadContent) {
                    result.push('âŒ æ— ä¸‹è½½å†…å®¹');
                    success = false;
                } else {
                    result.push(`âœ… ä¸‹è½½å†…å®¹é•¿åº¦: ${downloadContent.length} å­—ç¬¦`);
                    
                    // æ£€æŸ¥å…³é”®å…ƒç´ 
                    const hasBackground = downloadContent.includes('background') || downloadContent.includes('linear-gradient');
                    const hasText = downloadContent.length > 500; // ç®€å•çš„å†…å®¹ä¸°å¯Œåº¦æ£€æŸ¥
                    const hasStructure = downloadContent.includes('<div') && downloadContent.includes('</div>');
                    
                    result.push(`èƒŒæ™¯æ ·å¼: ${hasBackground ? 'âœ… å­˜åœ¨' : 'âŒ ç¼ºå¤±'}`);
                    result.push(`æ–‡æœ¬å†…å®¹: ${hasText ? 'âœ… ä¸°å¯Œ' : 'âŒ ä¸è¶³'}`);
                    result.push(`HTMLç»“æ„: ${hasStructure ? 'âœ… å®Œæ•´' : 'âŒ ä¸å®Œæ•´'}`);
                    
                    if (hasBackground && hasText && hasStructure) {
                        result.push('âœ… æ¨¡æ‹Ÿä¸‹è½½æµ‹è¯•é€šè¿‡ - å†…å®¹è´¨é‡è‰¯å¥½');
                    } else {
                        result.push('âŒ æ¨¡æ‹Ÿä¸‹è½½æµ‹è¯•å¤±è´¥ - å†…å®¹è´¨é‡æœ‰é—®é¢˜');
                        success = false;
                    }
                }
                
            } catch (error) {
                result.push(`âŒ æµ‹è¯•å¤±è´¥: ${error.message}`);
                success = false;
            }

            showResult('download-result', 'download-status', result.join('<br>'), success);
        }

        // é¡µé¢åŠ è½½æ—¶çš„æç¤º
        window.addEventListener('load', function() {
            console.log('ğŸ¯ é¢„è§ˆä¸ä¸‹è½½ä¸€è‡´æ€§éªŒè¯å·¥å…·å·²åŠ è½½ï¼');
            console.log('ğŸ“ ä½¿ç”¨æ–¹æ³•:');
            console.log('1. åœ¨ä¸»é¡µé¢(localhost:3000)ç”Ÿæˆå°é¢');
            console.log('2. å›åˆ°æ­¤é¡µé¢è¿è¡Œå„é¡¹æµ‹è¯•');
            console.log('3. æŸ¥çœ‹æµ‹è¯•ç»“æœéªŒè¯ä¿®å¤æ•ˆæœ');
        });
    </script>
</body>
</html> 